<script src="./nosleep.js"></script>

<style>
	body{
		padding:0;
		margin:0;
		background-color: #000;
		color: #c7c7c7;
	}

	.noselect {
		-webkit-touch-callout: none; /* iOS Safari */
		-webkit-user-select: none; /* Safari */
		-khtml-user-select: none; /* Konqueror HTML */
		-moz-user-select: none; /* Old versions of Firefox */
		-ms-user-select: none; /* Internet Explorer/Edge */
		user-select: none;
	}

	#timer{
		margin: 0;
		position: absolute;
		top: 50%;
		left: 50%;
		transform: translate(-50%, -50%);
		font-size: 10em;
		font-family: monospace;
	}

	.timerOff{
		border: 5px solid #e81e4d;
	}
	.timerOn{
		border: 10px solid #1cdc95;
	}
	#nosleepbutton{
		position: absolute;
	    height: 50px;
	    bottom: 20px;
	    left: 50%;
	    width: 200px;
	    transform: translate(-50%, -50%);
	}
</style>

<!doctype html>
<html lang="en">
	<head>
	  <meta charset="utf-8">

	  <title>Timer Sincronizado</title>

	</head>

	<body class="timerOff" id="bodyposta">
	<div id="container">
		<div id="timer" class="noselect">
		</div>
		<button id="nosleepbutton" onclick="ActivarNoSleep()">Mantener pantalla encendida</button>
	</div>

	</body>
</html>



<script src="/socket.io/socket.io.js"></script>
<script>
	var isCounting = false;
	var socket = io();
	var timerDisplay = document.getElementById('timer');
	var bodyEle = document.getElementsByTagName('body')[0];
	var countingFrom = Date.now();



	function ShowTime(){
		let s;
		if(!isCounting){
			s = 0;
		}else {
			s = Date.now() - countingFrom;
		}


		var ms = s % 1000;
		s = (s - ms) / 1000;
		var secs = s % 60;
		s = (s - secs) / 60;
		var mins = s % 60;
		// var hrs = (s - mins) / 60;

		// return hrs + ':' + mins + ':' + secs + '.' + ms;
		secs = ("0" + secs).slice(-2);
		mins = ("0" + mins).slice(-2);
		timerDisplay.innerHTML = mins + ':' + secs;
	}

	function StartTimer(fromTime = Date.now()){

		countingFrom = fromTime;
  	  	isCounting = true;
		ShowTime()

		bodyEle.classList.remove('timerOff');
		bodyEle.classList.add('timerOn');

	}

	function StopTimer(){
		isCounting = false;
		ShowTime()

		bodyEle.classList.remove('timerOn');
		bodyEle.classList.add('timerOff');
	}

	bodyEle.addEventListener("click", function(event) {

		if(event.srcElement.id != "bodyposta") return;
		console.log("bodu click")
		socket.emit('clicked', Date.now());
	});


	(function(){
		 window.setInterval(ShowTime, 50)
	})();


	socket.on('start', function(msg){
	  console.log("start", msg)
	  StartTimer(msg)
	});

	socket.on('reset', function(msg){
	    console.log("reset", msg)
		StopTimer();
	});



	// nosleep
	var noSleep = new NoSleep();

	function ActivarNoSleep(){
		noSleep.enable();
		let but = document.getElementById('nosleepbutton')
 		but.parentNode.removeChild(but);
	}

	document.addEventListener('click', function enableNoSleep() {
		let but = document.getElementById('nosleepbutton')
 		but.parentNode.removeChild(but);
		
	  document.removeEventListener('click', enableNoSleep, false);
	  noSleep.enable();
	}, false);
</script>
